package ru.netology.nmedia

import androidx.lifecycle.LiveData
import androidx.lifecycle.MutableLiveData

class PostRepositoryInMemoryImpl : PostRepository {
    private var nextId = 1L
    private var posts = listOf(
        Post(
            id = nextId++,
            author = "–ù–µ—Ç–æ–ª–æ–≥–∏—è. –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–ø—Ä–æ—Ñ–µ—Å—Å–∏–π –±—É–¥—É—â–µ–≥–æ",
            content = "–ü—Ä–∏–≤–µ—Ç, —ç—Ç–æ –Ω–æ–≤–∞—è –ù–µ—Ç–æ–ª–æ–≥–∏—è!",
            published = "21 –º–∞—è –≤ 18:36",
            likedByMe = false,
            likes = 99999,
            shares = 0,
            views = 500
        ),
        Post(
            id = 2,
            author = "–ù–µ—Ç–æ–ª–æ–≥–∏—è. –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–ø—Ä–æ—Ñ–µ—Å—Å–∏–π –±—É–¥—É—â–µ–≥–æ",
            content = "–ó–Ω–∞–Ω–∏–π —Ö–≤–∞—Ç–∏—Ç –Ω–∞ –≤—Å–µ—Ö!",
            published = "18 —Å–µ–Ω—Ç—è–±—Ä—è –≤ 10:12",
            likedByMe = false,
            likes = 50000,
            shares = 0,
            views = 1000
        ),
        Post(
            id = 3,
            author = "–ù–µ—Ç–æ–ª–æ–≥–∏—è. –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–ø—Ä–æ—Ñ–µ—Å—Å–∏–π –±—É–¥—É—â–µ–≥–æ",
            content = "–Ø–∑—ã–∫–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –º–Ω–æ–≥–æ, –∏ –≤—ã–±—Ä–∞—Ç—å –∫–∞–∫–æ–π-—Ç–æ –æ–¥–∏–Ω –±—ã–≤–∞–µ—Ç –Ω–µ–ª–µ–≥–∫–æ. –°–æ–±—Ä–∞–ª–∏ –ø–æ–¥–±–æ—Ä–∫—É —Å—Ç–∞—Ç–µ–π, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –Ω–∞—á–∞—Ç—å, –µ—Å–ª–∏ –≤—ã –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ —Å–≤–æ–π –≤—ã–±–æ—Ä –Ω–∞ JavaScript.",
            published = "19 —Å–µ–Ω—Ç—è–±—Ä—è –≤ 10:24",
            likedByMe = false,
            likes = 300,
            shares = 10,
            views = 200
        ),
        Post(
            id = 4,
            author = "–ù–µ—Ç–æ–ª–æ–≥–∏—è. –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–ø—Ä–æ—Ñ–µ—Å—Å–∏–π –±—É–¥—É—â–µ–≥–æ",
            content = "–ë–æ–ª—å—à–∞—è –∞—Ñ–∏—à–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –æ—Å–µ–Ω–∏: –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏, –≤—ã—Å—Ç–∞–≤–∫–∏ –∏ —Ö–∞–∫–∞—Ç–æ–Ω—ã –¥–ª—è –∂–∏—Ç–µ–ª–µ–π –ú–æ—Å–∫–≤—ã, –£–ª—å—è–Ω–æ–≤—Å–∫–∞ –∏ –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫–∞.",
            published = "19 —Å–µ–Ω—Ç—è–±—Ä—è –≤ 14:12",
            likedByMe = false,
            likes = 150,
            shares = 5,
            views = 300
        ),
        Post(
            id = 5,
            author = "–ù–µ—Ç–æ–ª–æ–≥–∏—è. –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–ø—Ä–æ—Ñ–µ—Å—Å–∏–π –±—É–¥—É—â–µ–≥–æ",
            content = "–î–∏–¥–∂–∏—Ç–∞–ª –¥–∞–≤–Ω–æ —Å—Ç–∞–ª —á–∞—Å—Ç—å—é –Ω–∞—à–µ–π –∂–∏–∑–Ω–∏: –º—ã –æ–±—â–∞–µ–º—Å—è –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö –∏ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞—Ö, –∑–∞–∫–∞–∑—ã–≤–∞–µ–º –µ–¥—É, —Ç–∞–∫—Å–∏ –∏ –æ–ø–ª–∞—á–∏–≤–∞–µ–º —Å—á–µ—Ç–∞ —á–µ—Ä–µ–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.",
            published = "20 —Å–µ–Ω—Ç—è–±—Ä—è –≤ 10:14",
            likedByMe = false,
            likes = 250,
            shares = 7,
            views = 400
        ),
        Post(
            id = 6,
            author = "–ù–µ—Ç–æ–ª–æ–≥–∏—è. –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–ø—Ä–æ—Ñ–µ—Å—Å–∏–π –±—É–¥—É—â–µ–≥–æ",
            content = "üöÄ 24 —Å–µ–Ω—Ç—è–±—Ä—è —Å—Ç–∞—Ä—Ç—É–µ—Ç –Ω–æ–≤—ã–π –ø–æ—Ç–æ–∫ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –∫—É—Ä—Å–∞ ¬´–î–∏–¥–∂–∏—Ç–∞–ª-—Å—Ç–∞—Ä—Ç: –ø–µ—Ä–≤—ã–π —à–∞–≥ –∫ –≤–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω–æ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏¬ª ‚Äî –∑–∞ –¥–≤–µ –Ω–µ–¥–µ–ª–∏ –≤—ã –ø–æ–ø—Ä–æ–±—É–µ—Ç–µ —Å–µ–±—è –≤ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ—Ñ–µ—Å—Å–∏—è—Ö –∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ, —á—Ç–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –∏–º–µ–Ω–Ω–æ –≤–∞–º.",
            published = "21 —Å–µ–Ω—Ç—è–±—Ä—è –≤ 10:12",
            likedByMe = false,
            likes = 320,
            shares = 15,
            views = 450
        ),
        Post(
            id = 7,
            author = "–ù–µ—Ç–æ–ª–æ–≥–∏—è. –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–ø—Ä–æ—Ñ–µ—Å—Å–∏–π –±—É–¥—É—â–µ–≥–æ",
            content = "–¢–∞–π–º–±–æ–∫—Å–∏–Ω–≥ ‚Äî –æ—Ç–ª–∏—á–Ω—ã–π —Å–ø–æ—Å–æ–± –Ω–∞–≤–µ—Å—Ç–∏ –ø–æ—Ä—è–¥–æ–∫ –≤ —Å–≤–æ—ë–º –∫–∞–ª–µ–Ω–¥–∞—Ä–µ –∏ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å –¥–µ–ª–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–≥–æ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–ª–∏ –Ω–∞ –ø–æ—Ç–æ–º. –ï–≥–æ –≥–ª–∞–≤–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø ‚Äî –Ω–∞ –∫–∞–∂–¥–æ–µ –¥–µ–ª–æ –∑–∞—Ä–∞–Ω–µ–µ –≤—ã–¥–µ–ª—è–µ—Ç—Å—è –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –æ—Ç—Ä–µ–∑–æ–∫ –≤—Ä–µ–º–µ–Ω–∏. –í —ç—Ç–æ –≤—Ä–µ–º—è –≤—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ —Ç–æ–ª—å–∫–æ –Ω–∞–¥ –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–µ–π, –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—è—Å—å –Ω–∞ –¥—Ä—É–≥–∏–µ. –°–æ–±—Ä–∞–ª–∏ —Å–æ–≤–µ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥—É—Ç –≤–Ω–µ–¥—Ä–∏—Ç—å —Ç–∞–π–º–±–æ–∫—Å–∏–Ω–≥.",
            published = "22 —Å–µ–Ω—Ç—è–±—Ä—è –≤ 10:12",
            likedByMe = false,
            likes = 180,
            shares = 8,
            views = 500
        ),
        Post(
            id = 8,
            author = "–ù–µ—Ç–æ–ª–æ–≥–∏—è. –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–ø—Ä–æ—Ñ–µ—Å—Å–∏–π –±—É–¥—É—â–µ–≥–æ",
            content = "–î–µ–ª–∏—Ç—å—Å—è –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è–º–∏ –æ –ª—é–±–∏–º—ã—Ö —Ñ–∏–ª—å–º–∞—Ö –ª–µ–≥–∫–æ, –∞ —á—Ç–æ –µ—Å–ª–∏ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –≤—Å–µ –∑–∞—Å–∫—É—á–∞–ª–∏.",
            published = "22 —Å–µ–Ω—Ç—è–±—Ä—è –≤ 10:14",
            likedByMe = false,
            likes = 220,
            shares = 3,
            views = 600
        ),
        Post(
            id = 9,
            author = "–ù–µ—Ç–æ–ª–æ–≥–∏—è. –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–ø—Ä–æ—Ñ–µ—Å—Å–∏–π –±—É–¥—É—â–µ–≥–æ",
            content = "–û—Å–≤–æ–µ–Ω–∏–µ –Ω–æ–≤–æ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ ‚Äî —ç—Ç–æ –Ω–µ —Ç–æ–ª—å–∫–æ –æ—Ç–∫—Ä—ã–≤–∞—é—â–∏–µ—Å—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã, –Ω–æ –∏ –Ω–∞—Å—Ç–æ—è—â–∏–π –≤—ã–∑–æ–≤ —Å–∞–º–æ–º—É —Å–µ–±–µ. –ü—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –≤—ã—Ö–æ–¥–∏—Ç—å –∏–∑ –∑–æ–Ω—ã –∫–æ–º—Ñ–æ—Ä—Ç–∞ –∏ –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø—Ä–∏–≤—ã—á–Ω—ã–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏: –º–µ–Ω—è—Ç—å —Ä–∞—Å–ø–æ—Ä—è–¥–æ–∫ –¥–Ω—è, –∏—Å–∫–∞—Ç—å –≤—Ä–µ–º—è –¥–ª—è –∑–∞–Ω—è—Ç–∏–π, –±—ã—Ç—å –≥–æ—Ç–æ–≤—ã–º –∫ –≤–æ–∑–º–æ–∂–Ω—ã–º –Ω–µ—É–¥–∞—á–∞–º –≤ –Ω–∞—á–∞–ª–µ –ø—É—Ç–∏. –í –±–ª–æ–≥–µ —Ä–∞—Å—Å–∫–∞–∑–∞–ª–∏, –∫–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å —Å—Ç—Ä–µ—Å—Å–∞ –Ω–∞ –∫—É—Ä—Å–∞—Ö –ø—Ä–æ—Ñ–ø–µ—Ä–µ–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏.",
            published = "23 —Å–µ–Ω—Ç—è–±—Ä—è –≤ 10:12",
            likedByMe = false,
            likes = 270,
            shares = 12,
            views = 700
        )
    ).reversed()

    private val data = MutableLiveData(posts)

    override fun getAll(): LiveData<List<Post>> = data

    override fun save(post: Post) {
        if (post.id == 0L) {
            posts = listOf(
                post.copy(
                    id = nextId++,
                    author = "Me",
                    likedByMe = false,
                    published = "now"
                )
            ) + posts
            data.value = posts
            return
        }

        posts = posts.map {
            if (it.id != post.id) it else it.copy(content = post.content)
        }
        data.value = posts
    }

    override fun likeById(id: Long) {
        posts = posts.map {
            if (it.id == id) it.copy(likedByMe = !it.likedByMe, likes = if (!it.likedByMe) it.likes + 1 else it.likes - 1) else it
        }
        data.value = posts
    }

    override fun shareById(id: Long) {
        posts = posts.map {
            if (it.id == id) it.copy(shares = it.shares + 1) else it
        }
        data.value = posts
    }

    override fun removeById(id: Long) {
        posts = posts.filter { it.id != id }
        data.value = posts
    }
}
